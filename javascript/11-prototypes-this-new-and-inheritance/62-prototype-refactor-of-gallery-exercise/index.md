






(https://wesbos.com/javascript/04-the-dom/built-in-and-custom-data-attributes)
    1.  [Data Attributes](https://wesbos.com/javascript/04-the-dom/built-in-and-custom-data-attributes/#data-attributes)
-   [Creating HTML<span class="videoNumber">Part 25</span>](https://wesbos.com/javascript/04-the-dom/creating-html)
    1.  [append method](https://wesbos.com/javascript/04-the-dom/creating-html/#append-method)
    2.  [insertAdjacentElement method](https://wesbos.com/javascript/04-the-dom/creating-html/#insertadjacentelement-method)
    3.  [Generating An Unordered List](https://wesbos.com/javascript/04-the-dom/creating-html/#generating-an-unordered-list)
-   [HTML from Strings and XSS<span class="videoNumber">Part 26</span>](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss)
    1.  [document.createRange() and document.createFragment()](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#documentcreaterange-and-documentcreatefragment)
    2.  [Security and Santization](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#security-and-santization)
    3.  [XSS (Cross Site Scripting)](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#xss-cross-site-scripting)
-   [Traversing and Removing Nodes<span class="videoNumber">Part 27</span>](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes)
    1.  [The difference between an Node and an Element](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#the-difference-between-an-node-and-an-element)
    2.  [Properties to work with Nodes and Elements](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#properties-to-work-with-nodes-and-elements)
    3.  [Removing Elements](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#removing-elements)
-   [Cardio<span class="videoNumber">Part 28</span>](https://wesbos.com/javascript/04-the-dom/cardio)
    1.  [closest method](https://wesbos.com/javascript/04-the-dom/cardio/#closest-method)



##### <span class="grit">Module 11 - Prototypes, this, new and Inheritance</span>

-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/60-the-new-keyword" class="currentModule">The New Keyword<span class="videoNumber">Part 60</span></a>
-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/61-the-this-keyword" class="currentModule">The This Keyword<span class="videoNumber">Part 61</span></a>
-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise" class="currentModule currentPage currentSection">Prototype Refactor of Gallery Exercise<span class="videoNumber">Part 62</span></a>
    1.  <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/#bind-method" class="currentModule currentPage">bind method</a>
-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/63-prototypes-and-prototypal-inheritance" class="currentModule">Prototypes and Prototypal Inheritance<span class="videoNumber">Part 63</span></a>
-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/64-prototype-refactor-of-the-slider-exercise" class="currentModule">Prototype Refactor of the Slider Exercise<span class="videoNumber">Part 64</span></a>
-   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/65-bind-call-and-apply" class="currentModule">Bind, Call and Apply<span class="videoNumber">Part 65</span></a>
    1.  <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/65-bind-call-and-apply/#bind-method" class="currentModule">Bind method</a>
    2.  <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/65-bind-call-and-apply/#call-and-apply-methods" class="currentModule">Call and Apply methods</a>
        -   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/65-bind-call-and-apply/#call-method" class="currentModule">Call method</a>
        -   <a href="https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/65-bind-call-and-apply/#apply-method" class="currentModule">Apply method</a>

##### <span class="grit">Module 13 - Ajax and Fetching Data</span>

-   [AJAX and APIs<span class="videoNumber">Part 74</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis)
    1.  [What is an API?](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#what-is-an-api)
    2.  [JSON](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#json)
    3.  [AJAX](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#ajax)
    4.  [Public API list](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#public-api-list)
-   [CORS and Recipes<span class="videoNumber">Part 75</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes)
    1.  [Query Parameters](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#query-parameters)
    2.  [CORS](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#cors)
        -   [What is CORS?](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#what-is-cors)
        -   [CORS policy](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#cors-policy)
    3.  [Babel](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#babel)
    4.  [Browserlist](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#browserlist)
    5.  [Proxy](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#proxy)
-   [Dad Jokes<span class="videoNumber">Part 76</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes)
    1.  [Headers](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#headers)
    2.  [Getting a Random Index](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#getting-a-random-index)
    3.  [Loading State & CSS Loader](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#loading-state--css-loader)
-   [Currency Converter<span class="videoNumber">Part 77</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter)
    1.  [Caching the Rates](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#caching-the-rates)
    2.  [Converting](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#converting)
    3.  [Hooking Up The UI](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#hooking-up-the-ui)
        -   [Input Event on a Form](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#input-event-on-a-form)
        -   [Wiring up Handlers](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#wiring-up-handlers)
        -   [Formatting Currency using Number Format API](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#formatting-currency-using-number-format-api)

##### <span class="grit">Module 14 - ES Modules and Structuring Larger Apps</span>
##### <span class="grit">Module 15 - Final Round of Exercises</span>


<span class="grit">Prototype Refactor of Gallery Exercise</span>
================================================================


JavaScript, PrototypesEdit Post

In the next two videos we will refactor the gallery and slider exercises that we did earlier to take advantage of the prototype.

Open up `gallery.js` and save a copy of the file under the name `gallery-prototype.js`.

Then go into the `index.html` file within the gallery exercise directory and modify the script src to point to the `gallery-prototype.js` file instead.

If you scroll to the bottom of the JavaScript page, you will see we have 2 variables `gallery1` and `gallery2`, and if we log them in the console, we will get `undefined` and `undefined`.

    const gallery1 = Gallery(document.querySelector('.gallery1'));
    const gallery2 = Gallery(document.querySelector('.gallery2'));

    console.log(gallery1, gallery2);

Why? because the `Gallery()` function doesn't actually return anything.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1198px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:8.533333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbklEQVQI1zWLywrEIBAE8/8/aMCI7hjHxyqKHjz24sAeCpqi64oxIqWEnDNqrcLfHcYYmHOCiBBCkF8pRTaRhyWG/TA4faW7TtRaAzOj9y7B4bjwBuy9sdaCUgrGGFhr4ZyD1lowz4P7Vni9F/8DA3KTu+JVmhUAAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/98343b87b568ce8172a41edd47ff4dc4/e72de/928.png" title="Gallery() function not returning anything" alt="Gallery() function not returning anything" class="gatsby-resp-image-image" /> </span>

If, however, we change it to use the `new` keyword, it will automatically return an instance of that gallery.

    const gallery1 = new Gallery(document.querySelector('.gallery1'));
    const gallery2 = new Gallery(document.querySelector('.gallery2'));

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1276px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:21.6%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsklEQVQY042M22qFMBRE/f/vK30oJG4152Bso+bm0aKukrz0rXRg7YHZwzQhBLz3KKXohx472YqML47vE7hJKdG2LVprhmFApEW3wtv7B1qGmpX/cRw0APu+Y61lsStT90mcI19LRkQwxrBtWx2NMZJzrl4IwZPzb15UB8/zpJMOUYLpHzg70T1XHlPktSWu6+I/uu+bppyieZ7xi8cZxzoupLTzHCe0UjjnaqcMl/5f/ADCWzJSpvOXjgAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/7c15c6d5620452bd5009fda0f8b30015/0d98f/929.png" title="gallery prototype" alt="gallery prototype" class="gatsby-resp-image-image" /> </span>

Right now there is nothing in our Gallery nor in the prototype of it, but you will see as we add things to the prototype and to the instance, we will see them populate there.

Let's go to the top of the file and go line by line.

    function Gallery(gallery) {
      if (!gallery) {
        throw new Error('No Gallery Found!');
      }
    }

The way we check whether the parameter exists is fine, we can leave that alone.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1338px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:26.400000000000002%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQY02MQ1rJUNfRQMQ5VNYlVMPNVtnJWtnRWtfNTtvZStnJXNDEV0zIWVDcV0oAjM0FNKwhiENexFDd0E7Rt5neYLeq3SMRnoZDbAi7LSXwGIfx6Pvz6Pnx6vrw6fny6vry6fnz6/nw6XgjNohqGbCYV3LaTZO2LRG0rxW0rxeyrZZxKBZybudxauN2a+XyauFxbeECMBg6Hbm7zSkENS5hmLSNu4wIVmxghLTMBLXtBLVsBTVsoCUI2MK6NIALBbBbRMhfUthHQdeXX8+A38BPQdeHX9+TX8+QzDODT9+YHibvxGfgJatkJalrCtUE0AwAJ1jn/ZlRjrgAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/ac4d62fcbe0e69a4689c199e2f030a50/b67f3/930.png" title="null check of gallery argument" alt="null check of gallery argument" class="gatsby-resp-image-image" /> </span>

The only thing we need to do is save the reference to the gallery div that was passed in because we will need it in our prototype method shortly.

Add the line below after the condition 👇

    this.gallery = gallery;

Now if you refresh the page, you should see both of our galleries logged, and you can see that those are instance properties because they differ in each one.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1276px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:98.93333333333334%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEbklEQVQ4y2XL+1PaBgDA8fxR+2Hb3ba77fpL1+1u3XX2cV3dPK/r9bb1cdpaWsXaWh+IFrqiaxEdpVoF5CWxIlB8Vi1WMCCBQB7EEAgkJBEEImZnb/1p35+/H+A3va3fPq8wOXvsXi3of2BduG+eH3D5VLa5jkmX8pV7yOkZAhe7Znz3zR4t6Fe5fPcmZ7tnPK0mO3DdNHf/1ftL3fbemehskGkZXb/w0GZYoo2W+dt9ow0KY5/Rb1yIX3kwcfnOyIR7a8SHn/zzaXOvXWn1AlcNs1cGwVMt47cNa9aNXNPA/MlG9RMHrHkxd6Z15MS1sbbheY3e3dDc1dDU+Xx6WeshPrv06IJyusMaAG6Y5jROqN24qQMT4Fa21wp1qcEJX6pv7PW5Nv3FDpP65eKUH76rnrrVNzHli5pW6V+6JjsMy92OAHB93G4AdzQzYf1saBnKTC4Ro/OwL8La/eG2wakB05J5YdsEvnvq2lWbw47lhBcqTK3RzmB+wOUHftZMnr7z4vOmwTNt46Y3WNNj34lrzzRg8vlc7OsrT849sN3VuVs1zkb1QqPKq50JjQRohQXtdpGKaS/QqH31Y+vIp+c7zitGR0HoB4Xxmz+ethv8I66d72/8ferms3ado8e4eOmR/dub+mFnSL9Id9rQfjd5z+wFmoetZ+8YP2novHjP9I8n8V3L+FeXtZ3jK5069xe/DHzZrFVoHTf7rSeuDp9uHftret2wwint6X4w22F5A1zWW5QvPRcfGm7pHXrvu991tuahqR5LoPuF46xS91O7TmXxKQ2WX3ueXx0ae2wGtZ5wu3n9kWOr5aUD0Njeeja3ZzfC3u33b0Lb4FZocG5jwLWmcq4Ogeua15tq91uVa1U9u6ZyrvQ5VnrtS/325UHXSqspACRTGIHisSgsFIUslUHiiWQimdmjeLaYgJFYFCYJkiuwTDZXEsSSIJREscAUeI7HcQJA0RSKoXAczuZyJEkiH0qniVSaebeDrgbhYATHyAyOoxSdI6gsRtIESdI0jSAIEIEiGIYFg8FMJrOzs0PTtCAILMsWCgWe58ulUp5hKIoKbm7sZdloMvM+RiaSBMeygUAAKJVKlUqlWq3WPlb9kCTV9vf3cSKNYTiVock9Ck+TiSROkFmKojAULZcPAFmWRVEkCCJDZziOo2maYXL5Qr5cruTTLJGIYbFtIgGlk7tIeD0V2cLg7WiCSpGsLNeP8UHlAE/gezBFxakclU1GKDiShENbSCSOQGEECiFQGI1BFbEo1yWpWq5J9fqRLMtHx1iSJIEVRHqfxbiqWGPzfCQMxSIQzxdrlQrPcaIgVivV41+WP6jjZFk+xhzHxeNxPIXTFE1gxB5JEul0PpdnCY7PUhyVLFKowJAMFi1m0DwBp7Olgij/h2tSjcKobCpHJ2iWYRmiUCBJGgmzJMZgsRy2mydgBt+tlsWjev2wVj2sH9XrH7EkSSIvlnIljixW+ArPCXB0F4nDBwflo0PpUKodz4eH8v/6F/2bmVBB6ke5AAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/a01800ec1b18279107477326e8357ba6/0d98f/931.png" title="both galleries logged in console" alt="both galleries logged in console" class="gatsby-resp-image-image" /> </span>

Now we need to go through all the variables we created.

We just created them as variables inside of the closure, but because we are going to be moving all of the methods like `handleClickOutside` and `handleKeyUp` to the prototype, they will no longer have access to the closure. That means we need to surface the variables on our instance somehow.

The way you can surface a variable on an instance is simply by saying `this.` the name of the variable.

So we will change all those variables and everywhere we have used them to `this.images` instead of `const images`.

The easiest way that Wes has found to do that is to right click on a variable name in VSCode and select "Rename symbol". Then add `this.` next to `const image` and remove the `const`, because we are not declaring a new variable, we are simply setting a property on the gallery instance.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:68.53333333333333%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACr0lEQVQoz3WS3U9ScRjHueoiJ+d3DijyoiAinhfgcF45LxzggLBDQJSu1UUrZ6XBGKhoYpgvraycoqZpvqCuuVlqF235/zXcWmFr+148N8++3+/neXR2T9xOxrv4/m5BM3nlTjbaLSZtTAzBRRgNwJgIY9L/pDMS/W1kysDegamM3hsHZBLyp/VErBVT9b4khIcAKgJMBqgEoxK4tmzxi3aahiIvPMNHqVw1NjSeKiwMjs0K2UedgYxDynQxQRfHujjWyXA9LOtgRBMf6hBVk0fVORjezVE2Xrs/+b5cq+ffbMzVz1fOLu89z/cwflQS+gKsg5KsIcWqKFZ/yEhICCEhHhnBZJ2d5nt5xsaoA4VX5bXD8vrR7P7ZwtGPzJNcL4PjAo0G6F5G6GBCpkjITEcNmAJQEUavYjto3sXxVrY/m69OrBxUtk9f7p4vfrm8/WzMTvpcHO9kWSctmEilXVQ6qLARD4LfFHVmH2ehlDa/mh6tFJa2Rxc3Ssv1yta30IP8zR4eYEEIlSG0AQz0SaAZvs6Eq1Yihjgl7XGhuLRWevexvHpQ3TmLPSy1OFkDLv+5VmNupm31RruFW2Yunh4pzH3an6+fzB9fVPcu1KEc4ucNHtnoURBMgNErXXMGuAyxiRukGns6Nbm6P7FxXFw7LG+eqCOVVjqBkCpMpyB/GvImIJ8G48rf+zojIdlI2Uxp2dxsaXm79GFzbPXzzN7XRG4aYLLBF4dQBcKjgFABocJYsMkZwaR2SoHEqJafmqrtFJdq4+u7r09/aoVyuxQwSxGTFLQwohEXwD/fqgOYbPLJXaQvPVKcqB3m3m4VasfTe9/DwzMt3jhMaYBJASoJ+TQ9mQZ4uCk24gkZvWFDH9/Jxd3huy4l61YH3ZEBC5NoXAgLXklptG0UbgL+C0Zzyu11QJE9AAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/4f80c2eace97b5bb1cbae95a6cf6d854/aa440/932.png" title="right clicking the variable and selecting go to definition" alt="right clicking the variable and selecting go to definition" class="gatsby-resp-image-image" /> </span>

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:6.133333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWElEQVQI1xXG0QpEQBiAUa+woV0XhB0uhGT/GTVMKewqm/d/m0/O1fHiZiNtd1J7kI9/wtrymFYCM1NKjxq+ZONJYn4oLSj9odDCW+5rInE83cyrW/CriQvhzh9K7yYwXwAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/fb199c53860ae3158261c79a3ccc1b98/aa440/933.png" title="selecting all the images using querySelectorAll" alt="selecting all the images using querySelectorAll" class="gatsby-resp-image-image" /> </span>

Now let's go through the rest of them.

    this.gallery = gallery;
    // select the elements we need
    this.images = Array.from(gallery.querySelectorAll('img'));
    this.modal = document.querySelector('.modal');
    this.prevButton = this.modal.querySelector('.prev');
    this.nextButton = this.modal.querySelector('.next');

We don't need the `let currentImage` variable anymore because wherever we set the `currentImage`, we will simply say `this.currentImage = el;` where we are setting the `currentImage` instead. So delete the `let` declaration of that variable.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1290px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:45.06666666666666%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz2XOWY/TMBSG4f7/nzKANCwVggsWzQUXiCXTkqhN4iaO1yS24zhrnfagtgNC4r06N8/RtwIAKWWOsRBCG00IEVI2tmm4taI0LDU8c0ooEluJDcv6vsMYA8C7jw8r730S7zN0QHG6fdwGP75RghFC0SbkB4wfdzwOsu8PPN1jlITBV5QmjDEAeP/5y+q0LLzSrDAqq+ui1DS1VdHYNsO4KChjUiutcF2iWhFR5lEtmV9OAPD2w6cVAJh2pkXbGze68Tj40Y5zr0db+cnNnbncTp2WGf60nC74xXp9wZ1zOMiLgCiiVKkkFjTcKUJYtK+ylO0SRXB14MfJa6K898uyAMDdyxvuuvwnphvaGqdYXTNEo9AZO7THaTi6up+GuZV2GiYr7TAM3vsLvn/zhGlE6YaJvahQVeFC7FJVVL2RnWLXpWf4p9vs56+vuO97vhP8F2chV1g30mqkZVyWh7DKwydxPv99csPPXl2xc85wo3NjsOlMl8TJNthKXp5P3s8T/NcN392vfwPJ0/CxR7sYCQAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/61e6f9afd26270f15af561ef7d3775bd/46115/934.png" title="console log of gallery with having properties in it" alt="console log of gallery with having properties in it" class="gatsby-resp-image-image" /> </span>

As you can see, our gallery now has all these properties inside of it.

Next we will share the rest of the functions amongst all the instances by moving them to the prototype.

Select all the functions below.

    function openModal() {
      console.info('Opening Modal...');
      // First check if the modal is already open
      if (modal.matches('.open')) {
        console.info('Madal already open');
        return; // stop the function from running
      }
      modal.classList.add('open');

      // Event listeners to be bound when we open the modal:
      window.addEventListener('keyup', handleKeyUp);
      nextButton.addEventListener('click', showNextImage);
      prevButton.addEventListener('click', showPrevImage);
    }

    function closeModal() {
      modal.classList.remove('open');
      // TODO: add event listeners for clicks and keyboard..
      window.removeEventListener('keyup', handleKeyUp);
      nextButton.removeEventListener('click', showNextImage);
      prevButton.removeEventListener('click', showPrevImage);
    }

    function handleClickOutside(e) {
      if (e.target === e.currentTarget) {
        closeModal();
      }
    }

    function handleKeyUp(event) {
      if (event.key === 'Escape') return closeModal();
      if (event.key === 'ArrowRight') return showNextImage();
      if (event.key === 'ArrowLeft') return showPrevImage();
    }

    function showNextImage() {
      showImage(currentImage.nextElementSibling || gallery.firstElementChild);
    }

    function showPrevImage() {
      showImage(currentImage.previousElementSibling || gallery.lastElementChild);
    }

    function showImage(el) {
      if (!el) {
        console.info('no image to show');
        return;
      }
      // update the modal with this info
      console.log(el);
      modal.querySelector('img').src = el.src;
      modal.querySelector('h2').textContent = el.title;
      modal.querySelector('figure p').textContent = el.dataset.description;
      currentImage = el;
      openModal();
    }

Cut those functions out of the `Gallery()` function and add them right below the function.

Now what we need to do is we need to change each of those functions to be on the prototype of the gallery.

We are going to remove the word `function` and instead will put `Gallery.prototype`, as shown below.

    Gallery.prototype.openModal() {
      console.info('Opening Modal...');
      // First check if the modal is already open
      if (modal.matches('.open')) {
        console.info('Modal already open');
        return; // stop the function from running
      }
      modal.classList.add('open');

      // Event listeners to be bound when we open the modal:
      window.addEventListener('keyup', handleKeyUp);
      nextButton.addEventListener('click', showNextImage);
      prevButton.addEventListener('click', showPrevImage);
    }

If you save and refresh, you will see that we now have access to the `openModal` function on the prototype of our galleries. Nothing will work yet but we will go through and fix them one by one.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1190px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:49.33333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbklEQVQoz33OS3PTMBSGYf//v8SCSSEdWFGGNG5zsRPLiu6yZOlIvsg2U9MFZIY+a73nU2atISUhZyoqoZjiF6HwTdSvtMwbgXh15NULr0+NwEMa+3EY0tDFd1noAjkQ9KOmL8y1jiKmmUC7g6GE5GeNEX4+NjcsCgQNQOMttfPyLgsxkCMtv13UTVvZihvj6Fjv8wgRdNd3o1cAbfANGGFiGxvadF2c57cLWewCKxh6qvmF8xOXVyavJTsXTtgebDB8ntLyH28xPVH0VFc/a7wnvJIS6fqZ4H3NipwXu7Hv1pfzn7Vl/iuGAIaZ5tq0teq165xPECcH0XiwOlj10XKaktOWnNTDlm0e+XZnvqPxyxGYH9a55QPZsiyttZdf+PMGPWz55pF9ffWfdia/cGu0lFKtpJRa65TSfWyMCRp65Xvpkg1ea3rDp8MBY8w5Jyu2uo+naQKA2AavwEmIvrPOFWVJCJmm6e6f079+A2ESNDmop4YHAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/87a95134e84311208e13f6d779ef4371/393aa/935.png" title="access of openModal function in console " alt="access of openModal function in console " class="gatsby-resp-image-image" /> </span>

Wes likes to use VSCode multi-cursor to refactor the methods all at once.

His shortcuts are to hold down Click + Cmd and then put the cursor in front of every function name so you can edit them all at once.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:87.2%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC00lEQVQ4y22T2Y7bNhhGfd+MJVuLtXmTbIvUTonipsWyNPLMZOwkRYG8/6Ok8qRomxY44BUP+ePjx5kKuRoKJ37eF2878dmr7xsy+rRwcbnHpYvxBgmdnjVc2+j5WN339O1Y3VdxJ0ExW/rMTKga8gWs5KCWg0aCtRIwJaRaSNWQKQFbhGIRCiWotLBWg0qLmmUgZMBnS8Ds9GyiVyN7XeNuTbp1eV7lFzkZnuJxHg9SNEjJID+Q/oGcPM8UQM3ksi/+OLHvQX8Hl3fYv3vtu0MHu7xo5EUTL0r2KqWjlF6l9Cr/zThTIFNDrgf0iKhb1NtUuHm9Q42HcFBkbk62mO4SsonxOsJegtwY6QGZ+0wGbKYApgXCKUavuu9JBTg9EHIs8yMpDpiZpLaFsPLLsbm54u1U3aysV+NWjdtFUE2yEvJNfD3gm1vf/O73LX0BLIc8B6zwygLyfJPXRtPpuNmzz+D87dh8ge23VdxNshEzPWyM+LJCvZk/a8nZSukHRsLslOpRpaB6mdRG2lmot9Fgo0EJmkleRUKG1RKKJSQyIAvIZcAlwKRp5U8+l4CQgJCBkHw2/wt5emdAnaw/ZOMhuwX1cOK1V+AT575ogrZ3+WCm3XKqgJDhdIcMq0UwMclTYGGlRcwjLWz7Uz3qSaPGrY76VTYY+WAkFwXWD/NXppKoU3saKxNrRMyML8LmMTb/OSRg/2v+lM2EyZB+8vlvp+rTqX7yxdwXc8DmQDwmnPYtHvxHhtRKzmbYO9GwRdTJsJMRBwkjG4ykkqCYg0oC4uPEKbZfZCNud3F7KN78ajyIbp+TLeHrZlzTsxVRJykdJDwqDlTY6flfsgrZMhRWWOzL667+uqu+mnGlI2GcW7vvLNoeUnYqMKQ4b/KQEZ/gbdY9Yv9IOxJGQJyst8urjcdVxLWE66RZ8UZNGyem6xhv0tJF2MtzvyjNaPrMf8o/AGgxryE53tuiAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/cc7867d90ccaf972eceb76520f5a245c/aa440/936.png" title="selecting and putting cursor in front of multiple functions using shortcuts " alt="selecting and putting cursor in front of multiple functions using shortcuts " class="gatsby-resp-image-image" /> </span>

    Gallery.prototype.openModal() {
      console.info('Opening Modal...');
      // First check if the modal is already open
      if (modal.matches('.open')) {
        console.info('Madal already open');
        return; // stop the Gallery.prototype.from running
      }
      modal.classList.add('open');

      // Event listeners to be bound when we open the modal:
      window.addEventListener('keyup', handleKeyUp);
      nextButton.addEventListener('click', showNextImage);
      prevButton.addEventListener('click', showPrevImage);
    }

    Gallery.prototype.closeModal() {
      modal.classList.remove('open');
      // TODO: add event listeners for clicks and keyboard..
      window.removeEventListener('keyup', handleKeyUp);
      nextButton.removeEventListener('click', showNextImage);
      prevButton.removeEventListener('click', showPrevImage);
    }

    Gallery.prototype.handleClickOutside(e) {
      if (e.target === e.currentTarget) {
        closeModal();
      }
    }

    Gallery.prototype.handleKeyUp(event) {
      if (event.key === 'Escape') return closeModal();
      if (event.key === 'ArrowRight') return showNextImage();
      if (event.key === 'ArrowLeft') return showPrevImage();
    }

    Gallery.prototype.showNextImage() {
      showImage(currentImage.nextElementSibling || gallery.firstElementChild);
    }

    Gallery.prototype.showPrevImage() {
      showImage(currentImage.previousElementSibling || gallery.lastElementChild);
    }

    Gallery.prototype.showImage(el) {
      if (!el) {
        console.info('no image to show');
        return;
      }
      // update the modal with this info
      console.log(el);
      modal.querySelector('img').src = el.src;
      modal.querySelector('h2').textContent = el.title;
      modal.querySelector('figure p').textContent = el.dataset.description;
      currentImage = el;
      openModal();
    }

It won't even load now because we get these errors like

> handleClickOutside is not defined

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1286px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:20.8%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4ElEQVQI1w3L226CMAAAUP7/gxbMAtkQ21JZxMm9UOTmoIhxRUQEy3bej8RVhVvWA8K7qt4RmvNsLvKpyESZt67j63q6xalpxgYKISAIldYuwkbl2Atj0lzkvfLer976lTxs9NH+niIyeu64xQM2Wgiunx8dgh0EN2vXHfb9l/k4lc+qWs5MEg17HvaDAUewESQQNH75/hKRKc9+aXyJyC1NeUIvJDyHAT8m14S2gSfqH9EwSbB66fjsOdzEdK0dNe0EQbrWKDaALNsQuAhhRal9r3SdJgxZGDSe+6qr//wHb8jPCc0QKlkAAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/bdc74378b5c2b9dcba91ebfbbaffb5ae/d7e70/937.png" title="uncaught error - handleClickOutside is not defined" alt="uncaught error - handleClickOutside is not defined" class="gatsby-resp-image-image" /> </span>

If you go to line 29, you will see we are calling `showImage(e.currentTarget)`.

Anytime we reference one of our functions, it needs to be changed to `this.showImage`.

That is where ESLint becomes very helpful. If you click ESLint at the bottom, you can see all of the problems.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:726px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:102.13333333333334%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAACl0lEQVQ4y22Uy3KbMBSGvekqxnYdQOiCIdjchC4OEhdBkmbT6QN0mWfo+287Eq5rp53RMNr8Ov/5/nNYxZQW55LQ6tdH1Khik2m/aLeZDCvtlxrU/dfj85PgidD7XHkpvz2r/Umk4jmV874wUTMRbsJKB6UOq+4xb/1CbU/61wecXk5fyHmXCS/l64RdxA8Jg0dxqDUSJhYGsTGiPeEGshHUfUSHoFR+2T0WKrCPqs2T8DLhJcxL2Mo7trhUCTNx++3QvpHzK5EvSM5QzEi+YPkKGhO6A5hx99Gv++2x3RzblZdrUnepmEj7Tp7f8vF7/+Nn2EyJesfnV8BmwGfAJvvlU8TngJrNSXu53uTa2kZHEVcKNAOkPWbWuV8q2AyEG996Vn6hrraDUm8zsU7YOmGrh5Sjk4xrjfmE2Yi5ieiwtB3RPqi6wGJXlmKlw9pS/Ev7IeX4JA9UEzEd5EzEBJ2FWCzku7Cy5G3ZPw/didFJWtrcEG5iMWE+gqrD9j5bcd0tydknnIXtk7wTx04cy3mJCrNxCRw4JbAya/sxbzdPwqZ1Z7vSkI2xnCPah6VGrvkFjytr3Tpg+qq8sw2ZtY35CJsxqDTmI+HTVe872svwbTNxJ05oh7jBbIy5jWrJCXMD6u46rUvzn2kvPUNmYnmhRZg5yNlx1mF5KQjqzl/G818x4gbSgfAJshExG3JEe79UTrPQ1vu83WVy/UmcWtsTogOoe+ho3Rh2OZcXWteVuqlcqcj1idgYlBrS4eBCtpqidRNi9/yW1h1tzKeI9sjNNmIDqDpru2hvQ95l8j89J01H7Gwa1FhlLCZI+7DqLubdSoSVtg0nN38SL2W7XIfUEGaBRU3vhmxw/h2tYtkkub2ZrUX8G8cTsU7+aL40AAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/5acc0805dba5529bc3f487e762fe542e/f8067/938.png" title="problems in code highlighted by ESLint" alt="problems in code highlighted by ESLint" class="gatsby-resp-image-image" /> </span>

Now we can go through them one by one and change them out.

    Gallery.prototype.openModal = function() {
      console.info('Opening Modal...');
      // First check if the modal is already open
      if (this.modal.matches('.open')) {
        console.info('Madal already open');
        return; // stop the function from running
      }
      this.modal.classList.add('open');

      // Event listeners to be bound when we open the modal:
      window.addEventListener('keyup', this.handleKeyUp);
      this.nextButton.addEventListener('click', this.showNextImage);
      this.prevButton.addEventListener('click', this.showPrevImage);
    };

    Gallery.prototype.closeModal = function() {
      this.modal.classList.remove('open');
      // TODO: add event listeners for clicks and keyboard..
      window.removeEventListener('keyup', this.handleKeyUp);
      this.nextButton.removeEventListener('click', this.showNextImage);
      this.prevButton.removeEventListener('click', this.showPrevImage);
    };

    Gallery.prototype.handleClickOutside = function(e) {
      if (e.target === e.currentTarget) {
        this.closeModal();
      }
    };

    Gallery.prototype.handleKeyUp = function(event) {
      if (event.key === 'Escape') return this.closeModal();
      if (event.key === 'ArrowRight') return this.showNextImage();
      if (event.key === 'ArrowLeft') return this.showPrevImage();
    };

    Gallery.prototype.showNextImage = function() {
      console.log('SHOWING NEXT IMAGE!!!');
      this.showImage(
        this.currentImage.nextElementSibling || this.gallery.firstElementChild
      );
    };
    Gallery.prototype.showPrevImage = function() {
      this.showImage(
        this.currentImage.previousElementSibling || this.gallery.lastElementChild
      );
    };

    Gallery.prototype.showImage = function(el) {
      if (!el) {
        console.info('no image to show');
        return;
      }
      // update the modal with this info
      console.log(el);
      this.modal.querySelector('img').src = el.src;
      this.modal.querySelector('h2').textContent = el.title;
      this.modal.querySelector('figure p').textContent = el.dataset.description;
      this.currentImage = el;
      this.openModal();
    };

Now we have refactored everything (all our variables and methods) to be reference-able by `this.` and their name.

Let's go through the app and find any issues that might exist. We will first find all the bugs, make a list and then fix them.

Let's click on an image, the modal should open fine, but when we click the buttons, we get an error. If you try to click outside the modal to close it, that is also broken.

If you hit escape that is also broken.

Let's tackle those so far, starting with the next/prev buttons being broken.

The error says

> cannot read property 'nextElementSibling' of undefined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:9.6%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVQI1xXG0Q6CIBQAUP//l1rNthqXmmh5BTTjxQRp1UODCcxV6zydzB8PLt+4/c5t87lkMys8BQ/k/1MV1XWx9mPtq+91g5PgI9YT5xrxrVS2dG0A4tarSEkAElkRKEQKqWKpZKk+Jynul85IYYQYEE0rdYNxvH2fjx+WJWep/Bqx2gAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/73c8639023a692a20fb1f8dcd773a661/aa440/939.png" title="uncaught type error: cannot read property &#39;nextElementSibling&#39; of undefined" alt="uncaught type error: cannot read property &#39;nextElementSibling&#39; of undefined" class="gatsby-resp-image-image" /> </span>

The line that is throwing the error is

    this.showImage(
      this.currentImage.nextElementSibling || this.gallery.firstElementChild
    );

`this.currentImage` is `undefined`. So what is the value of the `this` we have highlighted in the image below?

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:18.133333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAt0lEQVQI11WO2QqCQABF/QM3HB2VyiBccJlFy63SGceoHwh660v69TBFCM7D4d77cCW5ZKBqQNsZ1XWD80NBPEo9gs3ovE8eu3R00VEPT7JfKcGC7Jcz0u7y2davpK2jRlhYADRAIpz8Bgm3KDeSRo+Flt4hHSDqIeY2HdxidHJhEy7B41vNniDrTcRtwizUWaj/SW+TASStFjM9HSFhZjZVE5jNIil+oQbF+mf9thDW6iRr/jf4AlJEKVsfTNotAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/b53900e8323213facf47d19f0812eb38/aa440/940.png" title="adding this keyword to access objects own property" alt="adding this keyword to access objects own property" class="gatsby-resp-image-image" /> </span>

Let's add a log and take a look. As far as we know, `this` should always equal the instance of the gallery.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:16.53333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqUlEQVQI1wXBixKBQBQA0P7/l4xBwqSaStLDbsbosa+724qoqeEcY55mBT1vOgkKhKpJL0ELyoCxum7L6llVGkTHHhInd8G5BMEpVQCMUqMPQ23t28XqubX0ctl6p862lbnW5ka7gfaj1+3xaej7XpVRQq85R6hJU8CYZKnxAzEVaHCPw2E3uM7o2mMYjJ4zBv50OU9xNCfxF18JyqHAJM9InjGEJEY/EH+MP59oBDtAngAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/f230545eed4300b2923d564c31fc0c28/aa440/941.png" title="uncaught type error: cannot read properties &#39;nextElementSibling&#39; of undefined" alt="uncaught type error: cannot read properties &#39;nextElementSibling&#39; of undefined" class="gatsby-resp-image-image" /> </span>

According to the log, `this` is equal to a button within our `showImage` method.

Let's find where `showNextImage()` is called from... it is being called from within the `closeModal` function to remove the event listener. It is also being called from another method to add the event listener.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:51.2%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvUlEQVQoz02S63KiQBCFeQJhVRQQFCIQcFCYYS7MIMpFgWiMyfu/zBbqbqXq+9G3U3WquyV1k03jWiM3DZZGetBQqSXFPK4mpB3jsxp187jT6E0n1zm6yFEjB1wJxRNpCvgybn3+5e3P4eHsi8NWJAHDjmBrzixUL0Rt0/6d3d391yr7WPGLiVsleIjVSCxAae3OJustdl3i6i1NbYRXEK8RnsH9hIoZKCzQmKRdsf4tv9qkV965EnDJRmKOT6O4U5JWic9y0j7onigPhgA+eLXaZ10y00It+om4jPOPP8VlJlqH7j3BDVSY6NNGdwudJrvDCFSjqJKjUvmFpILcCAsPVeussXHpssZOjz5GPiIW5RYUekQ1QLQNWQCsbqgcciUcPA+2Z1GuxcWggWSNkJciBxI3xQ7MFiw3oHC2Ryet3Kzxs3oJS/ldyMHvbe96n327h8+wvHl5vckSIJBPiV9Ql3Kd1FpROenVJd/e8cct7m5xt3CnBEKaRUIHx8WuMfDJwJ0OSwsSC1IzoVZCzJhNk/0YiTk4GtvawKcFbpes15NmEE8CNgZcDoUc8AeDqyH9x3DS/5XXzOtP/gLEjGshjJO03QAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/56bacb1c270f24a367779d8f5c0720b7/aa440/943.png" title="showNextImage function is called within closeModal function" alt="showNextImage function is called within closeModal function" class="gatsby-resp-image-image" /> </span>

What is happening is we are listening for a click and when the click happens, the `showNextImage` function is running.

However, like Wes has told us about passing callbacks to `addEventListener` and the keyword `this`?

Whenever you pass a callback to an event listener, the `this` keyword will be equal to whatever is to the left of the dot.

So how do we fix that?

There are a few ways which we will go over now.

A popular way in React word would be to make it an arrow function like so

    this.nextButton.addEventListener('click', () => this.showNextImage);

Now that works, but there is a problem with that which Wes will demonstrate once we get the Escape key working.

Let's refactor this method as well using an arrow function to get that working

    window.addEventListener('keyup', e=> this.handleKeyUp(e));

Now when you open the modal up, and hit the escape key, and repeat that a few times, when you click right, it will jump a few images instead of going to the next one.

What is going on there?

Every time we close the modal, it is going one further down the slideshow. Every time that we open it up, we are listening for another click on it already.

The way we fixed that before is we just removed the event listener when we closed the modal. That way we added and removed it every time that we opened and closed the modal.

However what happens when you use `() => this.showNextImage())` what is highlighted in the image below is that you are creating an anonymous function, and in order to remove an event listener, you have to have reference to that function.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1500px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:48.53333333333334%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVQoz02O246aUABF+YHKXRxRRAHhgNwP54oeUUSnOpNMkyZt2iZNX/vS/39qnGmbJuthJzsre0saYFrWa/lZzzotO2rZQU87NR+U4qxmvZqe9M3JSFsjF3q6V9btyGcjH5txPcmwNEnZEj255H3I2hXeeQgHDbGJsJmYVJ1d7WfVy0P7dcG+e8ePyXMfnHfL4TSBVyWikrXhq/SyItdAfHDpDZA6oZUP6wSVC7i12q1VXSz002a//NMP9OlSvgzhpbfRTb3LCTFAq8fciFsj5npMtZhpMdMTosZUSe55DLC5wfcqEq/PiRxiFTBpXAsNdWol1GavQjHNybJu7BxNks5Jz7NMmBsqA65EXAFMBfROzFTA77KZtvOiX5JhTs4OGRbN0W/IuoZzuHWabppyM8EGwCbA+t38o70hmTFz6/0acr8oQV15FfJKuK7gArFpTf10uyp2ERWA7GY5l0Msh1iJ6F854X79tGK3UDx6bAgxjGkZoMZjOCB43hyn7cEpr/H2dvi2FZ9J94W6jZBDpgEmWQl3NicHDi69zZuzWyEPQrdqljX0KmTVrYH4Q7J3in7VDn57CXaP0+LwNi6NN0QGRI7IaI3lkMghH/2HEjElZAqgckRHAXn3yr/bvwEnt2rqDlIe8AAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/1647cc757fcaaba3c256ba6ce6c46fbb/aa440/944.png" title="creating an anonymous function inside event listener and calling this.showNextImage()" alt="creating an anonymous function inside event listener and calling this.showNextImage()" class="gatsby-resp-image-image" /> </span>

The other way we can fix that is by binding it to `this` when we have access to `this` inside of the gallery.

It will get a bit complicated but don't sweat it if you don't get it right away. It took Wes a couple of years to get it. This will make sense eventually (like the 7th or 8th time you build something this way). This is pretty common in React world.

So now we need to bind our methods to the instance when we need them.

We will do that for `handleKeyUp`, `showNextImage` and `showPrevImage` because they are the ones giving us trouble.

    this.showNextImage = this.showNextImage.bind(this);

What we are doing there is we are creating an instance property of the same prototype function, but bound with `this`.

<span class="grit"><a href="#bind-method" class="hash-anchor before"></a>bind method</span>
-------------------------------------------------------------------------------------------

`bind()` allows us to explicitly supply what `this` will be equal to. Because in our constructor `this` is equal to the instance, we are creating a new function that has `this` bound to it.

That allows us to now go to our `findNextImage` function and simply just pass `showNextImage` without using an arrow function like so 👇

    this.nextButton.addEventListener('click', this.showNextImage);

Now the next button should work.

The previous button won't work because we haven't fixed that yet.

The benefit of doing that over doing it right in the event listener call directly as shown in the example below is that when we do it like below, we lose reference to the new function that was created, which stops us from being able to remove that event listener in the future.

You always need to hold onto your functions when you create them so you can remove them in the future.

    this.nextButton.addEventListener('click', this.showNextImage.bind(this));

Let's do the same for `showPrevImage`.

    this.showPrevImage = this.showPrevImage.bind(this);

The escape key is also working, but only because we are passing the `e` like so `window.addEventListener('keyup', e=> this.handleKeyUp(e));`

Modify that line of code as shown below.

    window.addEventListener('keyup', this.handleKeyUp);

Now go to where you bound `this` for `showNextImage` and `showPrevImage` and do the same for `handleKeyUp`.

    this.handleKeyUp = this.handleKeyUp.bind(this);

The last one is the click outside, which is the same problem.

    this.handleClickOutside = this.handleClickOutside.bind(this);

A lot of people don't like this method of doing it because it is a bit of a pain to figure out how to bind `this` in each context, so a lot of people prefer to just have a bunch of functions.

It is not as explicit as when you have a bunch of functions so if you feel that way, then it may mean that the prototype way of coding is not for you. There are lots of people who to think that way.

Wes is showing us all the approaches because there are some developers who think prototypes are the best way to work and it will come up on interviews.

Now everything is working beautifully.

If you feel like a challenge, feel free to try to refactor the slider one yourself.

Find an issue with this post? Think you could clarify, update or add something?

All my posts are available to edit on Github. Any fix, little or small, is appreciated!

[Edit on Github](https://github.com/wesbos/wesbos/tree/master/src/javascript/11-prototypes-this-new-and-inheritance/62-prototype-refactor-of-gallery-exercise/62-prototype-refactor-of-gallery-exercise.mdx)

[**← Prev**](https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/61-the-this-keyword/)

The This Keyword

[**Next →**](https://wesbos.com/javascript/11-prototypes-this-new-and-inheritance/63-prototypes-and-prototypal-inheritance/)

Prototypes and Prototypal Inheritance

### <span class="highlight">Syntax Podcast</span>

Hold on — I'm grabbin' the last one.
