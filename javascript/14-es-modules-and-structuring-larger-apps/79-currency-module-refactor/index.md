






(https://wesbos.com/javascript/04-the-dom/built-in-and-custom-data-attributes)
    1.  [Data Attributes](https://wesbos.com/javascript/04-the-dom/built-in-and-custom-data-attributes/#data-attributes)
-   [Creating HTML<span class="videoNumber">Part 25</span>](https://wesbos.com/javascript/04-the-dom/creating-html)
    1.  [append method](https://wesbos.com/javascript/04-the-dom/creating-html/#append-method)
    2.  [insertAdjacentElement method](https://wesbos.com/javascript/04-the-dom/creating-html/#insertadjacentelement-method)
    3.  [Generating An Unordered List](https://wesbos.com/javascript/04-the-dom/creating-html/#generating-an-unordered-list)
-   [HTML from Strings and XSS<span class="videoNumber">Part 26</span>](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss)
    1.  [document.createRange() and document.createFragment()](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#documentcreaterange-and-documentcreatefragment)
    2.  [Security and Santization](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#security-and-santization)
    3.  [XSS (Cross Site Scripting)](https://wesbos.com/javascript/04-the-dom/html-from-strings-and-xss/#xss-cross-site-scripting)
-   [Traversing and Removing Nodes<span class="videoNumber">Part 27</span>](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes)
    1.  [The difference between an Node and an Element](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#the-difference-between-an-node-and-an-element)
    2.  [Properties to work with Nodes and Elements](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#properties-to-work-with-nodes-and-elements)
    3.  [Removing Elements](https://wesbos.com/javascript/04-the-dom/traversing-and-removing-nodes/#removing-elements)
-   [Cardio<span class="videoNumber">Part 28</span>](https://wesbos.com/javascript/04-the-dom/cardio)
    1.  [closest method](https://wesbos.com/javascript/04-the-dom/cardio/#closest-method)




##### <span class="grit">Module 13 - Ajax and Fetching Data</span>

-   [AJAX and APIs<span class="videoNumber">Part 74</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis)
    1.  [What is an API?](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#what-is-an-api)
    2.  [JSON](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#json)
    3.  [AJAX](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#ajax)
    4.  [Public API list](https://wesbos.com/javascript/13-ajax-and-fetching-data/74-ajax-and-apis/#public-api-list)
-   [CORS and Recipes<span class="videoNumber">Part 75</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes)
    1.  [Query Parameters](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#query-parameters)
    2.  [CORS](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#cors)
        -   [What is CORS?](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#what-is-cors)
        -   [CORS policy](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#cors-policy)
    3.  [Babel](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#babel)
    4.  [Browserlist](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#browserlist)
    5.  [Proxy](https://wesbos.com/javascript/13-ajax-and-fetching-data/75-cors-and-recipes/#proxy)
-   [Dad Jokes<span class="videoNumber">Part 76</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes)
    1.  [Headers](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#headers)
    2.  [Getting a Random Index](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#getting-a-random-index)
    3.  [Loading State & CSS Loader](https://wesbos.com/javascript/13-ajax-and-fetching-data/76-dad-jokes/#loading-state--css-loader)
-   [Currency Converter<span class="videoNumber">Part 77</span>](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter)
    1.  [Caching the Rates](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#caching-the-rates)
    2.  [Converting](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#converting)
    3.  [Hooking Up The UI](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#hooking-up-the-ui)
        -   [Input Event on a Form](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#input-event-on-a-form)
        -   [Wiring up Handlers](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#wiring-up-handlers)
        -   [Formatting Currency using Number Format API](https://wesbos.com/javascript/13-ajax-and-fetching-data/77-currency-converter/#formatting-currency-using-number-format-api)

##### <span class="grit">Module 14 - ES Modules and Structuring Larger Apps</span>

-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules" class="currentModule">Modules<span class="videoNumber">Part 78</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#what-are-modules" class="currentModule">What are Modules?</a>
    2.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#use-cases" class="currentModule">Use Cases</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#modules-in-the-browser" class="currentModule">Modules in the Browser</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#in-the-past---sharing-javascript-code-between-files" class="currentModule">In the Past - Sharing JavaScript Code between Files</a>
    3.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#setting-up-server" class="currentModule">Setting up Server</a>
    4.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#importing-and-exporting-modules" class="currentModule">Importing and Exporting Modules</a>
    5.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#things-we-need-to-know-about-modules" class="currentModule">Things we need to know about Modules</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#scope" class="currentModule">Scope</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#difference-between-default-and-named-exports" class="currentModule">Difference between Default and Named Exports</a>
    6.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#renaming-modules" class="currentModule">Renaming Modules</a>
    7.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#more-ways-to-import" class="currentModule">More Ways to Import</a>
    8.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#loading-javascript-on-demand" class="currentModule">Loading JavaScript On Demand</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/#async" class="currentModule">async</a>
-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor" class="currentModule currentPage currentSection">Currency Module Refactor<span class="videoNumber">Part 79</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/#bootstrap--app-init-functions" class="currentModule currentPage">Bootstrap / App Init Functions</a>
-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/80-dad-jokes-modules-refactor" class="currentModule">Dad Jokes Modules Refactor<span class="videoNumber">Part 80</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/80-dad-jokes-modules-refactor/#refactoring-into-modules" class="currentModule">Refactoring into Modules</a>
    2.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/80-dad-jokes-modules-refactor/#fixing-refactoring-errors" class="currentModule">Fixing Refactoring Errors</a>
    3.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/80-dad-jokes-modules-refactor/#recap" class="currentModule">Recap</a>
-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel" class="currentModule">Bundling and Building with Parcel<span class="videoNumber">Part 81</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#benefits-of-bundlers" class="currentModule">Benefits of Bundlers</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#bundler-options--alternatives" class="currentModule">Bundler Options / Alternatives</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#using-parcel" class="currentModule">Using Parcel</a>
    2.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#dad-jokes-module" class="currentModule">Dad Jokes Module</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#installing-parcel" class="currentModule">Installing Parcel</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#adding-an-npm-script-to-packagejson" class="currentModule">Adding an NPM Script to package.json</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/81-bundling-and-building-with-parcel/#building-with-parcel" class="currentModule">Building with Parcel</a>
-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages" class="currentModule">Using Open-Source npm packages<span class="videoNumber">Part 82</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#node-modules-folder" class="currentModule">node-modules folder</a>
    2.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#using-third-party-packages" class="currentModule">Using Third Party Packages</a>
    3.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#third-party-node-modules" class="currentModule">Third Party Node Modules</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#waait-npm-package" class="currentModule">waait npm package</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#faker-npm-package" class="currentModule">faker npm package</a>
    4.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#commonjs-syntax-vs-ecma-script-modules-import" class="currentModule">CommonJS Syntax vs ECMA Script Modules import</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#date-fns-npm-package" class="currentModule">date-fns npm package</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#axios-npm-package" class="currentModule">axios npm package</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#lodash-npm-package" class="currentModule">lodash npm package</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/82-using-open-source-npm-packages/#await-to-js" class="currentModule">await-to-js</a>
-   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security" class="currentModule">Security<span class="videoNumber">Part 83</span></a>
    1.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#javascript-is-public" class="currentModule">JavaScript is public</a>
    2.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#xss-and-sanitizing-your-inputs" class="currentModule">XSS and Sanitizing your Inputs</a>
    3.  <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#farcebook" class="currentModule">FarceBook</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#image-event-hijacking" class="currentModule">Image Event Hijacking</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#sanitizing-user-data-with-dompurify" class="currentModule">Sanitizing User Data with DOMPurify.</a>
        -   <a href="https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/83-security/#https-origin" class="currentModule">HTTPS Origin</a>

##### <span class="grit">Module 15 - Final Round of Exercises</span>


<span class="grit">Currency Module Refactor</span>
==================================================


JavaScript, ES ModulesEdit Post

In this lesson let's take the currency conversion example we did and convert it into modules.

Feel free to try this one yourself.

Go into our `/exercises` folder and find the folder containing the currency converter we built.

Duplicate that folder within the `/exercises` root and rename it to `79 - Currency Module Refactor`. Within that folder let's get rid of the `money-FINISHED.js` file.

Open `index.html` and add a `type="module"` to the script tag.

`money.js` will be our JavaScript entry point.

Before we start refactoring, let's take a look at the code we are working with. 👇

    const fromSelect = document.querySelector('[name="from_currency"]');
    const fromInput = document.querySelector('[name="from_amount"]');
    const toSelect = document.querySelector('[name="to_currency"]');
    const toEl = document.querySelector(".to_amount");
    const form = document.querySelector(".app form");
    const endpoint = "https://api.exchangeratesapi.io/latest";
    const ratesByBase = {};

    const currencies = {
      USD: "United States Dollar",
      AUD: "Australian Dollar",
      BGN: "Bulgarian Lev",
      BRL: "Brazilian Real",
      CAD: "Canadian Dollar",
      CHF: "Swiss Franc",
      CNY: "Chinese Yuan",
      CZK: "Czech Republic Koruna",
      DKK: "Danish Krone",
      GBP: "British Pound Sterling",
      HKD: "Hong Kong Dollar",
      HRK: "Croatian Kuna",
      HUF: "Hungarian Forint",
      IDR: "Indonesian Rupiah",
      ILS: "Israeli New Sheqel",
      INR: "Indian Rupee",
      JPY: "Japanese Yen",
      KRW: "South Korean Won",
      MXN: "Mexican Peso",
      MYR: "Malaysian Ringgit",
      NOK: "Norwegian Krone",
      NZD: "New Zealand Dollar",
      PHP: "Philippine Peso",
      PLN: "Polish Zloty",
      RON: "Romanian Leu",
      RUB: "Russian Ruble",
      SEK: "Swedish Krona",
      SGD: "Singapore Dollar",
      THB: "Thai Baht",
      TRY: "Turkish Lira",
      ZAR: "South African Rand",
      EUR: "Euro",
    };

    function generateOptions(options) {
      return Object.entries(options)
        .map(([currencyCode, currencyName]) =>
          `<option value="${currencyCode}">${currencyCode} - ${currencyName}</option>`
        )
        .join("");
    }

    async function fetchRates(base = "USD") {
      const res = await fetch(`${endpoint}?base=${base}`);
      const rates = await res.json();

      return rates;
    }

    async function convert(amount, from, to) {
      // first check if we even have the rates to convert from that currency
      if (!ratesByBase[from]) {
        console.log(
          `Oh no, we dont have ${from} to convert to ${to}. So gets go get it!`
        );
        const rates = await fetchRates(from);
        console.log(rates);
        // store them for next time
        ratesByBase[from] = rates;
      }

      // convert that amount that they passed it
      const rate = ratesByBase[from].rates[to];
      const convertedAmount = rate * amount;
      console.log(`${amount} ${from} is ${convertedAmount} in ${to}`);
      return convertedAmount;
    }

    function formatCurrency(amount, currency) {
      return Intl.NumberFormat("en-US", {
        style: "currency",
        currency,
      }).format(amount);
    }

    async function handleInput(e) {
      const rawAmount = await convert(
        fromInput.value,
        fromSelect.value,
        toSelect.value
      );

      toEl.textContent = formatCurrency(rawAmount, toSelect.value);
    }

    const optionsHTML = generateOptions(currencies);

    // populate the options elements
    fromSelect.innerHTML = optionsHTML;
    toSelect.innerHTML = optionsHTML;

    form.addEventListener("input", handleInput);

Within the file: ...

-   Selecting a bunch of elements and have a `ratesByBase` and `currencies` object.

-   Have a few functions such as `generateOptions`, `fetchRates` which require the endpoint, and we have a `convert`, `formatCurrency` function plus one handler.

-   have **library functions** which are functions that are considered core to our application such as a few handlers, and `generateOptions` which is a helper/utility method, and we also have some data.

For this example, we won't use any folder structure. Instead Wes will show you how to do it with a **flat file structure**.

Within the `79 - Currency Refactor` folder create a file called `currencies.js` and paste the entire `currencies` object within it. It is a big enough object that Wes would give it it's own file.

    // currencies.js

    const currencies = {
      USD: "United States Dollar",
      AUD: "Australian Dollar",
      BGN: "Bulgarian Lev",
      BRL: "Brazilian Real",
      CAD: "Canadian Dollar",
      CHF: "Swiss Franc",
      CNY: "Chinese Yuan",
      CZK: "Czech Republic Koruna",
      DKK: "Danish Krone",
      GBP: "British Pound Sterling",
      HKD: "Hong Kong Dollar",
      HRK: "Croatian Kuna",
      HUF: "Hungarian Forint",
      IDR: "Indonesian Rupiah",
      ILS: "Israeli New Sheqel",
      INR: "Indian Rupee",
      JPY: "Japanese Yen",
      KRW: "South Korean Won",
      MXN: "Mexican Peso",
      MYR: "Malaysian Ringgit",
      NOK: "Norwegian Krone",
      NZD: "New Zealand Dollar",
      PHP: "Philippine Peso",
      PLN: "Polish Zloty",
      RON: "Romanian Leu",
      RUB: "Russian Ruble",
      SEK: "Swedish Krona",
      SGD: "Singapore Dollar",
      THB: "Thai Baht",
      TRY: "Turkish Lira",
      ZAR: "South African Rand",
      EUR: "Euro",
    };

    export default currencies;

Make a new file called `utils.js` and inside of that we will paste our `generateOptions` method and make it a named export.

    // utils.js
    export function generateOptions(options) {
      return Object.entries(options)
        .map(([currencyCode, currencyName]) =>
          `<option value="${currencyCode}">${currencyCode} - ${currencyName}</option>`
        )
        .join("");
    }

Next make another file called `lib.js`. Move the `fetchRates` and `convert` functions to that file.

    // lib.js
    export async function fetchRates(base = "USD") {
      const res = await fetch(`${endpoint}?base=${base}`);
      const rates = await res.json();

      return rates;
    }

    export async function convert(amount, from, to) {
      // first check if we even have the rates to convert from that currency
      if (!ratesByBase[from]) {
        console.log(
          `Oh no, we don't have ${from} to convert to ${to}. So gets go get it!`
        );
        const rates = await fetchRates(from);
        console.log(rates);
        // store them for next time
        ratesByBase[from] = rates;
      }

      // convert that amount that they passed it
      const rate = ratesByBase[from].rates[to];
      const convertedAmount = rate * amount;
      console.log(`${amount} ${from} is ${convertedAmount} in ${to}`);
      return convertedAmount;
    }

Take the next function `formatCurrency` and put it in the `utils.js` file like so 👇

    // utils.js
    export function generateOptions(options) {
      return Object.entries(options)
        .map(([currencyCode, currencyName]) =>
          `<option value="${currencyCode}">${currencyCode} - ${currencyName}</option>`
        )
        .join("");
    }

    export function formatCurrency(amount, currency) {
      return Intl.NumberFormat("en-US", {
        style: "currency",
        currency,
      }).format(amount);
    }

Next there is `handleInput` which is a handler, so make a new file called `handlers.js` and add that there.

    export async function handleInput(e) {
      const rawAmount = await convert(
        fromInput.value,
        fromSelect.value,
        toSelect.value
      );

      toEl.textContent = formatCurrency(rawAmount, toSelect.value);
    }

You should be left with the following code in `money.js`.

    // money.js
    const fromSelect = document.querySelector('[name="from_currency"]');
    const fromInput = document.querySelector('[name="from_amount"]');
    const toSelect = document.querySelector('[name="to_currency"]');
    const toEl = document.querySelector(".to_amount");
    const form = document.querySelector(".app form");
    const endpoint = "https://api.exchangeratesapi.io/latest";
    const ratesByBase = {};

    const optionsHTML = generateOptions(currencies);
    // populate the options elements
    fromSelect.innerHTML = optionsHTML;
    toSelect.innerHTML = optionsHTML;

    form.addEventListener("input", handleInput);

Now the code that is left is only responsible for:

-   generating the options and initializing them on page load on page load
-   adding the event listeners

Let's start by going through them one by one and deciding whether or not to move it out of `money.js`.

Open up `index.html` in a VSCode live server and look to see if we have any errors in the console.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1060px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:19.2%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwklEQVQI10XG7W6CMBSAYe7/orYfxmwmMoGEMcUxpKuHfuCm1J5K4XTRxZg8efNGWqlOd1IIzr6B7+vqSwKQ9zSOd568D9M0OFdXFXDOGWt2jelNZN7ifj63cWwXC0wSzLJzmlzKzbBZY5q4PMflErP0UhR+V/es2a5WsP7gxft5z6OhyPH15TCbseen02f5sy3HFoKSJFoCuLa9VQBJQVp50f4jJaMwejLGHn8PXXfU+qT1ZC0hXjn36F1wLjgMt/8DF3/c2GfshR8AAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/4a38db1561371a527ecfabfe39b5d0a6/77672/1238.png" title="uncaught reference error - generateOptions is not defined" alt="uncaught reference error - generateOptions is not defined" class="gatsby-resp-image-image" /> </span>

It is complaining that `generateOptions` is not defined. Let's import it.

    import { generateOptions } from "./utils.js";

Next we get an error saying `currencies` is not defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:898px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:14.133333333333335%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArElEQVQI11WK2Q7BQABF+//fxBPV2KqJqaUlKLpYZtBFUsYRw4uHk9x77rVUOOfmdLh1bHLHofQ8ctumGA5ML3pdikGfexhQirHxheuarZpNKX1h9msYELpDrPJzaLfImw2q6YQ6iXnsttQfthE6iXnGe/Qh45kmJhv2u59LTa+zlGu0wdKnI48oohJjVr5PMBqRLhashSBbLuFyQSuJlme0lN9sUH/uJc+gFG8gstyf1pFvJgAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/f86d99ef1f35afde81134f8cdcb2fa78/84cc5/1239.png" title="uncaught reference error - currencies is not defined" alt="uncaught reference error - currencies is not defined" class="gatsby-resp-image-image" /> </span>

Import `currencies` so we can pass it to `generateOptions`.

    import { generateOptions } from "./utils.js";
    import { currencies } from "./currencies.js";

WHen the page refreshes, we have yet another error. It is complaining that it cannot find an export named `currencies`.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1092px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:14.933333333333335%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQI1x3HbRNCMAAAYP//H6lUPpQu9KFOcsfYGLYZYd46a931fHs04nksihgAHCGeoh7nfY4FY12OBSE8jjlCZYJxCCmEZZbSvMgAIAhlYaitQTDfXKHrg3nsD3thmpN9HS/W5NjD+TQYRmfsJus0GtvFdQrbhhudPZ81AKrhmhL9ApPZ96fHfX4Fsuay5iulsqokY7LmA84+/66UfiumCFHtW3WtbJofoeSgHXBn3ngAAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/7666a9f9bb397b881b3aeaf78141e499/2cffa/1240.png" title="uncaught syntax error - requested module does not provide an export named currencies" alt="uncaught syntax error - requested module does not provide an export named currencies" class="gatsby-resp-image-image" /> </span>

That is because it is a default export, not a named export, so it doesn't need the curly brackets.

Modify it like so 👇

    import currencies from './currencies.js';

Now the console is complaining that `handleInput` is not defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:858px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:15.733333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVQI11WMwU6DQAAF+f//0WM9qbVdUygG2C7sUkONLSrLggeW0jFw8zB5yWTyguZlgzWGPklwcUyXpnRZRisE7i3GheHieynp8xwX7XG7HS6KqEVInea4wjDUFz6VIhjmUGz5fXrE3d/RP6wYXgVXXTCWGn+QeKMZjyXXU4VXB7ySy44yY6remT4qsA22NAQ32zBdzvgip4sikvUzarvhrDU63tOeKnAtU/PDbaa1/5j9wvfXcvoHYGPcaBzbU4UAAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/18c2269a0f81634b93df8b1dab3f1982/42d54/1241.png" title="uncaught reference error - handleInput is not defined" alt="uncaught reference error - handleInput is not defined" class="gatsby-resp-image-image" /> </span>

Let's fix that by adding `import { handleInput } from './handlers';`

Finally there are no more errors in the console, until you try to type an amount into the input. When you try this you will see a reference error in the console complaining that `convert` is not defined, and it is happening in `handlers.js` on line 2.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1082px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:76.8%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADKklEQVQoz02ITWzbdBiH32hnBBwQUNYiNJRKcOXABWlDbQ67T0hcNhDp7gihrZUYV0S1ookDJwSIquvYJm2a1mShC23sNds624m/HTt2/FW7ceLYadLGrf9/lIAQrx69en4PpFsf4O3Xmrem6Z9nwo0pXHk9eXoeacuNtVeU9dOdjTf41SllfYy8NtW8/aZ8c0pZfwttvYpffAhp5Swi3jHuvEf/9n5YzGLyTPL8E9S8odyaVu7MBsV3a6tZdi0r/5FlVmeV21lhPcvdnE2J05g5B6m6jKRvsHYNt66hxrdIXELq96jzGJtfYXsJG4vYWcTOVWxPxJ7gLCHtCjKvA/rrJVyEkwKov8BxIYOLgLansXbl6QpUb5yy12DzOyBWoPoDbC/D7o9ArgB5PXPyEDAxA2njSyR+jsT8EZtPxS+QcBGpX6P2vZi62GcuH3H5iF7oUQvDej6i8jGzEFELEX05FT9DzUVI2QuI+hjRueGzXErlEHUWcZ+m7q+Y/gjXcoiZx7U5xMx1iFzyYh7X53BtDtfmEXUuFS4B3n4ZlwD9mWn9DsfFDC4Brszg5lVcAFw6NZ4lQI+A+Qm6dwFvjh2XMvgR4CdvQ+Q8jq1CbBcPnGJsFWNrI3bKcZuPrYexPSn2mKFb6NuFiU++VYjdLSCrNFllyCpD7DDkBGKHJp48I3b+X5jKf7NaI//tFIgCK/B1UWBFgRMFThJ5WeRliW9InCLz/0RZGhdJ5CWBk1hGEjmBrzc1BWzLMnTd29vrBIEiy4os+X5bVq3q85qiWb6/r8iSpume3w6CoN/p+DwfdMfnui7olqW3WoZpOp7n+X4vjoNe5HZiyw9Nv6vqRtM0m3tdUfcamu44djcMTdPcb7dr9Tq4m5v7DBNKYshzUcsYWNaBqg41ddjSB1qjp8hdnu/Ijch0urZtSqKjNhxVdTUtMAxIGvKApgbl8kG5PKhUBiQRP3gQ3b9/uLs7YtmErSdsfSSJQ0PvW+a+oviKHBvGgW2hbgDHgwE+PDzphYnjHKnqyDJHhj4yjMSxR7o+ahmJaQ59b88w/Far53k91z3phXg4SPvx35u1rsXfOni2AAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/50cf27e1bd2ad27f3b965a8a71452bb6/21335/1242.png" title="uncaught reference error - convert is not defined" alt="uncaught reference error - convert is not defined" class="gatsby-resp-image-image" /> </span>

To fix that, import the `convert` function into `handlers`.

    import { convert } from "./lib.js";

    export async function handleInput(e) {
      const rawAmount = await convert(
        fromInput.value,
        fromSelect.value,
        toSelect.value
      );

      toEl.textContent = formatCurrency(rawAmount, toSelect.value);
    }

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1084px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:77.33333333333333%;position:relative;bottom:0;left:0;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADIklEQVQozzWQy28bVRjFr/kTuimoRNR5iAUrhBAbJP4QkHCRXIFUYIGgoSSFLkClKJRFJPa0hUhtilRQZbsppXGc8Tz8YJ7JvO48r8cex3aTcRKPZ+5Fk7TST0fnnO9bHRAL30/bH8etT8fcpWn70rT1SSx+m/h/R+0L+82LE7F4xBdjsXjQLsZScSIWo3amifxRon4Bksevkw1w/DBn3QJkA6QVEG+9QXaWuVVQ++Ulbw08vgGe/ASqP4NH1wG7Cp6ugEfXc5OHgFTPgET9NZWvJso1rH6XKNcS+WqirqThE2J/SdyvCVwkziKxF4n7wjgZWL+MrR8Abr6Ha+fwdj4sz0238qR2DnNvE++m9ed5bX1huDGn3ps3789p6/P6+rz715y2vqDdW0hqM7jxDsDNd3HtLN6e8R6cn1RnSO0sZt8k7op291VlLd8vvcbfmRXu5MU/8q1bs9rdWfH3/H+3Z6ebrxDuLYDdm9i4gs1l4ixhuJx5+0c8+Ic4V4izRKwl4p7gfZNhP48nbzdAujWTlkBayZm/ZbPhMsD/voz1y0kJJOVcWgFJOYNZBWgtW3RaAtNSLi0D/PQMIPpXRH6fKIXDdiGVC5lXPyPhfSJ/QJQCUT48Zb95YSIUyM7zmF21zwEv6rwEBRmKislLpxiCuMNLpiBnnDRQUkxRMQUZCtKJZsYAHFvn2DrLUAxNNTi6wdEsU+c4ttlgTvsGR3NsnaEpht5mGIpl6yy9zTIUy1DAtm1d113XRQipqqppahAEhmHIkoSQ7/u+pqqu4wQI9fph3/eRLHf7YQchz3MBdGwDQh/5qNOxHcdHftAfKjBoKdau3YO2peqGaiHT7Tqe1wuCECEUBN1uV9U0YMuSb1uB63QsOOr1xqPRftiLhoODvXDo+66qdm3bsTqW1bF0w7Ngr9PxIAxcV5NlcCwK+xwTVSrRVvVIlsY0HVWrB5ubY4aeCHwsiRNJnKi7uBscId+TxO7uzp6h9w0dD/YAfjaKbeuw2Yzo+phlI4qKKGpcrx+1WseSdMjzsaGPLOjIcgjNgWOPIMTDAX42SoeD/wEAdKy5IRIa6wAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/4669f9773fb20ca1418e3793f296edef/48ca3/1244.png" title="uncaught reference error - fromInput is not defined" alt="uncaught reference error - fromInput is not defined" class="gatsby-resp-image-image" /> </span>

Now we get another error that `fromInput` is not defined. Within `handleInput` use the `fromInput`, `fromSelect`, `toSelect` and `toEl` variables.

We also reference the function `formatCurrency` which we haven't imported.

Import it to `handlers.js` like so `import { formatCurrency } from "./utils";`

We need all those elements, and rather than pass them in as an argument to the function, let's put them in their own module.

Create a new file called `elements.js`.

Go into `money.js` and take all the selectors and move them to the new `elements.js` file. Add the export keyword in front of each like so 👇

    // elements.js
    export const fromSelect = document.querySelector('[name="from_currency"]');
    export const fromInput = document.querySelector('[name="from_amount"]');
    export const toSelect = document.querySelector('[name="to_currency"]');
    export const toEl = document.querySelector(".to_amount");

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:610px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:23.2%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQY03XObUvCUBjG8X3/b9B3iOhtGBlKq4iITFGzdG46t9x21s7Z2YPb/rFFhEQX/Li43tzcRqBLrPWet4nLYuziR5pIZYQyJ1Q5kSoJ5I+CSB8I07Lrvcy7FnmFyL4ZppPTm7kMnz+47NsMpzHDyYL+3SO96wHme8CZ6XNyvqT3EnCzklyMPa5eI07NOYOV5H534HZbdIy0qAlVhe36bO0Ae+axHDls1j77MMaa7VjPfaYPFp4Xo6uGtKw7qqjQ5e9uGQBpdiBLU2TwiXACxCYkEQlKSnSk0EKR7ARFmvE3zdEy6rqh/TL2Bc7IwXqyUInivzRNc6SNzjLquu5OfwE/U3mi6H5zeQAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/9ee41b453f1411b8a9e3db2d5af17f52/5aae9/1245.png" title="div with class app in elements tab" alt="div with class app in elements tab" class="gatsby-resp-image-image" /> </span>

What people will often do is instead of using `document.querySelector` for all of those, they will grab a parent element like the div with a class of `app` in the example above, and then look for the selectors inside of there.

You would have `app.querySelector` for each of those instead which allows you to have multiple on the same page, just like we did with the slider.

The way we are doing it is fine for now.

If you refresh the page, we have an error `fromSelect` is not defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1086px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:18.133333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAw0lEQVQI1zXI24qDMBRAUf//szqlbw6mJGoUozXekhNIStEc660ILeyHxQ7qquJJ0jUNZ8wZY41xxjgwFkC3rciyhFLZAs/KQjT3/1B1fSdlnqadlMGLUgxDf7vtQvgomhlFQiZyxzRd6gcS8ibRxBiKauZ8rR91HA9ZZkSh8jzAmI3XP3u5KJ4+S+FE8arKDfSm9WZgVcPS9xuoM61WreZhOFPDW6tgX5ZjGr1z0PdPMA5gtHZH3D3u3p/4+nsOxOM3P9Ik2hpw5EpcAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/2adbcca75fbf23d6e13d5f80e200fad1/f3a19/1246.png" title="uncaught reference error - fromSelect is not defined" alt="uncaught reference error - fromSelect is not defined" class="gatsby-resp-image-image" /> </span>

Let's first go into `handlers` and import those elements.

    import { convert } from "./lib.js";
    import { formatCurrency } from "./utils.js";
    import { fromInput, fromSelect, toSelect, toEl } from "./elements.js";

    export async function handleInput(e) {
      const rawAmount = await convert(
        fromInput.value,
        fromSelect.value,
        toSelect.value
      );

      toEl.textContent = formatCurrency(rawAmount, toSelect.value);
    }

Let's tackle the `fromSelect` is not defined issue happening in `money.js` on line 11.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1406px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:21.066666666666663%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1klEQVQI113L20rDMACA4b6EydYpTlA8JD0krW0ac6j0MMaoy1y2bHgYwmQD8f1vpQheCB//3e8BxP1IIc7QQ3FbLoJ6FTYuatwpVUQxqntpySKZYalxtcSVxY+La9GCQHnDUJ6n1Uny5MstlDtQbCCzgK2H4hUyB3MLxA7wFz/rIKkhaX4NaN9+PqMlmX1M3465+UTtO+n2fPWdmuOltrTbJ+bA7Ne9OYyV84vnEV/+8QaBGMUKaZO07k7Nb9Q8qNfxZHuR1VdiFjYOVzaebMb5FIT6nx+g5zZO+0GPHwAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/a48c12a4be7e2c4034665dd34dc1e163/4a00e/1247.png" title="setting the innerHTML using html" alt="setting the innerHTML using html" class="gatsby-resp-image-image" /> </span>

As you can see, `fromSelect` and `toSelect` are also needed from `money.js` on page load. Let's go ahead and import them.

    // money.js
    import { generateOptions } from "./utils.js";
    import currencies from "./currencies.js";
    import { handleInput } from "./handlers.js";
    import { fromSelect, toSelect } from "./elements.js";

    const form = document.querySelector(".app form");
    const endpoint = "https://api.exchangeratesapi.io/latest";
    const ratesByBase = {};

    const optionsHTML = generateOptions(currencies);
    // populate the options elements
    fromSelect.innerHTML = optionsHTML;
    toSelect.innerHTML = optionsHTML;

    form.addEventListener("input", handleInput);

When the page is now refreshed, we are getting an error that ratesByBase is not defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:778px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:18.4%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQI1yXL0W6CMBQAUP7/e7ZHH8DZBhkpyyjiWhqqgFUxjPaWMp3r4pac1xPoQ2frGuraCAFtC1KClKaqoGmMlEYIU1UPjKmC7bf1oM5z37v+opUKTP4OUaSfniEMZ84dpVOaujieEHJJYtHqxvm1LK+cfwtx71qvtR8GP45f51NwV2ouNzaOLUIQLeeCmm25e8tOlHZZ5hjzFjz80dpr8/OYn/8Cb+2t2bs8B4QhCmG91hgfF4sLxiMh5mU5JQlg7NLUCLF5TT4I2RXFgfOKkF8AqtSR0JMQOAAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/12ed6c8e5347afebf0e3f8404cb9f6dd/20982/1248.png" title="uncaught reference error - ratesByBase is not defined" alt="uncaught reference error - ratesByBase is not defined" class="gatsby-resp-image-image" /> </span>

Our `endpoint` and `ratesByBase` variables need to go in our `lib.js` file.

Copy those over to the lib.js file.

    // lib.js
    const endpoint = "https://api.exchangeratesapi.io/latest";
    const ratesByBase = {};

    export async function fetchRates(base = "USD") {
      const res = await fetch(`${endpoint}?base=${base}`);
      const rates = await res.json();

      return rates;
    }

    export async function convert(amount, from, to) {
      // first check if we even have the rates to convert from that currency
      if (!ratesByBase[from]) {
        console.log(
          `Oh no, we dont have ${from} to convert to ${to}. So gets go get it!`
        );
        const rates = await fetchRates(from);
        console.log(rates);
        // store them for next time
        ratesByBase[from] = rates;
      }

      // convert that amount that they passed it
      const rate = ratesByBase[from].rates[to];
      const convertedAmount = rate * amount;
      console.log(`${amount} ${from} is ${convertedAmount} in ${to}`);
      return convertedAmount;
    }

When the page is refreshed, you will see that it is now working! Feel free to play around with the app to test it.

That was simpler than Wes expected -- he thought dealing with the `ratesByBase` variable would be tricky because we are updating it.

However, the beauty of module scope is that inside of the module, we can create the `ratesByBase` object and update it from our `convert` function. Even though we are calling the `convert` from another file, it still knows about the scope of the file (similar to how a closure works), so we can still access it without issues.

The only gotcha about these modules is that if you are on a server, the `ratesByBase` will be shared by every request that comes in which may or may not be what you want.

Wes has ran into an issue where Wes was storing data in one module that was being overwritten by multiple users. If that is the case, you need to get into sessions or scope it to each function but in our case, and most cases ,this is fine.

We have refactored the entire app into modules, which makes it a bit more organized to work with and more modular.

<span class="grit"><a href="#bootstrap--app-init-functions" class="hash-anchor before"></a>Bootstrap / App Init Functions</span>
--------------------------------------------------------------------------------------------------------------------------------

One more thing Wes wants to show us is a situation where we might take the form element and put it into a bootstrap or app init function. What does that mean?

All of this code in `money.js` runs on page load.

    // when the page loads, this code runs
    const form = document.querySelector(".app form");

    const optionsHTML = generateOptions(currencies);
    // populate the options elements
    fromSelect.innerHTML = optionsHTML;
    toSelect.innerHTML = optionsHTML;

    form.addEventListener("input", handleInput);

Sometimes you might want to delay the running of what happens on page load.

If that is the case, what we would do is take all that logic from `money.js` and go to `lib.js` and make another function like so 👇

    // lib.js
    export function init() {
      // when the page loads, this code runs
      const form = document.querySelector(".app form");

      const optionsHTML = generateOptions(currencies);
      // populate the options elements
      fromSelect.innerHTML = optionsHTML;
      toSelect.innerHTML = optionsHTML;

      form.addEventListener("input", handleInput);
    }

We also need to import `fromSelect` and `toSelect`.

Add the following import 👇statement to the other imports at the top of `libs.js`.

    import { fromSelect, toSelect } from "./elements.js";

If you try to play around with the app now, nothing happens because no code has started.

To fix that go back to`money.js`, and import that `init` function and use it to start the app.

    import { generateOptions } from "./utils.js";
    import currencies from "./currencies.js";
    import { handleInput } from "./handlers.js";
    import { fromSelect, toSelect } from "./elements.js";
    import { init } from "./lib.js";

    init();

If you refresh the page now, you will see the following error complaining that `generateOptions` is not defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:911px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:17.066666666666666%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtElEQVQI1y3JUY6CMABFUfa/pZkN+CEhAWtqJDYdsRHbIqVjRUOvGcePl5O8W8ivb6KUTFXFVJbEpuEmBElK0p9tS1IKv17zKwTXsmKoBXG3YzYGqzX94YBpW+L5TPHTNOSuI9U1cbUiVRVRa65aMyjF7XgE70mnE4tzZGfJbx3Ze57OMV8uPKxlGQYKvd3CfOepFFYIus0Gs9+jpSQYw73vySHANLGMI0sI/36Ww/ju+fO/AHuF3yJE7wcqAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/76f242361d2a94bd7bdbf1571bc9cd2c/636c2/1249.png" title="uncaught reference error - generateOptions is not defined" alt="uncaught reference error - generateOptions is not defined" class="gatsby-resp-image-image" /> </span>

We need to go to `lib.js` and import `generateOptions`.

    import { fromSelect, toSelect } from "./elements.js";
    import { generateOptions } from "./utils.js";

Now if we refresh it is complaining about `currencies` not being defined.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:724px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:21.866666666666667%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1UlEQVQY042My1KDQBBF+f/PsfwCWelGhYw8BCYOI2QWEYbwSHgdC1LuXZzqvrerjyMeHhm0pglDuiCgFYI2iu4zCOi2Xgj6JGFQil5KujimDUNsGFEnGU0q95/b+YyTPr8wRhGN69I+uVzfPVZjGI9HJvXFnCuuUnLLcxZjmIuCWWsmpfbbUpYsZcGkNWtV4WSHA1jLdDrRv75hfR/redRZhvwQ6Dgm/4z5SVOoaxZrWTea5s5ftpZlF/o+DANzXTFKicky8ijGbLuU2OIbLpdd9B9+AUANKZugp1awAAAAAElFTkSuQmCC');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/cbf3d74f6b908fe390cc821c2411eb43/a242d/1250.png" title="uncaught reference error - currencies is not defined" alt="uncaught reference error - currencies is not defined" class="gatsby-resp-image-image" /> </span>

What we can do is go to `money.js` and take all our import statements except for the `init` import and move them to `lib.js`.

    import { fromSelect, toSelect } from "./elements.js";
    import { generateOptions } from "./utils.js";
    import currencies from "./currencies.js";
    import { handleInput } from "./handlers.js";

Wes' ESLint is complaining about the `handleInput` import. The error says "Dependency cycle detected".

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1077px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:26.93333333333333%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVQY0x3EC26CMAAAUM7gdApOBbsAtlgoFIQBbiIKrb99ZDpFidnuf4YFk5cnDPwloK9DJwZ0KpOwh31Apx3oNlSrqdktzblPWrrd0u3HkdNUiRLN0O5TeVsJkjODkxi5IfSioenJ2H0mfh853ZEl6aaomaKKuyPSVscPAD4A1JA1Eb88Beu2sxQkmgz9FEzmwEtkO+pjb4Bd2fSAHcjWpGZ6CvF7YypB+45IVthx8w7NBBAkh++oKGL+Fe/OH8XtZ18V++q4PTL+HpwKP9uGi+N885tv/1h+SnmZxpuF6HLRZQKeJXR9QFlpsDNkF4NXBq/Gq5vBryg/G6yEWQnZpcZriF/07KqktX8Li0Cas+u+vgAAAABJRU5ErkJggg==');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/6635685270e2ca27c5b3edac87c35165/e3829/1251.png" title="dependency cycle detected eslint warning in code" alt="dependency cycle detected eslint warning in code" class="gatsby-resp-image-image" /> </span>

If you look at our `handlers.js`, we are importing `convert` from there from `lib`. So both files require each other. That could cause you to end up with a situation where they require each other and it gets out of control.

For our purposes, it is working, but let's fix that anyway.

Create one more file called `init.js`

Take the `init` function and all the imports added out of `lib.js` and put it in our `init.js` file instead.

    // init.js
    import { fromSelect, toSelect } from "./elements.js";
    import { generateOptions } from "./utils.js";
    import currencies from "./currencies.js";
    import { handleInput } from "./handlers.js";

    export function init() {
      // when the page loads, this code runs
      const form = document.querySelector(".app form");

      const optionsHTML = generateOptions(currencies);
      // populate the options elements
      fromSelect.innerHTML = optionsHTML;
      toSelect.innerHTML = optionsHTML;

      form.addEventListener("input", handleInput);
    }

In `money.js`, modify the code to import from `init.js` instead.

    // money.js
    import { init } from "./init.js";

    init();

If you refresh the page and play with the app, you will see that it is working!

You could go one step further and not even run the code unless someone clicks a button or hovers over it.

To do that, select the div with class of app within `money.js`.

Pass the event listener to our `init` function to call, and pass it the options object to the event listener to specify we only want it to run once, like so 👇

    import { init } from "./init.js";

    const app = document.querySelector(".app");

    app.addEventListener("mouseenter", init, { once: true });

When the page loads, it should just say "Select a Currency" until you hover over the form, and then the code initializes and the base currency is switched out to USD.

<span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:800px"> <span class="gatsby-resp-image-background-image" style="padding-bottom:53.06666666666666%;position:relative;bottom:0;left:0;background-image:url(https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQoz3WR3UsUYRTGBwSD/MTK7O+yyxQhgkoUw48sE3T1Qo1EMwkhuo0wqMTEFXetNJJS0xl3d9yv2d3Z1dYPSN1V3Jl3frEzknrRxY/nOQ8vh3PeI0W1OFo89X9iOlosQSyevID2z+u217Q4siwjib2voNZDsA2CLedog8B9SI/D77eYym0stQkr0OigOioCTeC/AzuTqMEY0on2EtNdgOm9jum5coa3EnO6ABFoJCs/4JNLYuZpOfPDJSyOlrIwUoJ3sATPYDk/RiRyoV7UUBIpt/sdM/gYM9yLGXZhhFy2muEezI1HmOkJRPoDR0ozmfVOjnwdHPmfkPV1kF3vIOvrJCM3Y2zPoAa1fMN5xGlDEXZhRVy2inCPnYv0e8z0R6xQO8RcEO3GinRhRbpBy+OCSDvm7uxpw+gQwl2A8FZizFawMlbMsbsCa85Z2fLfJSs32iu7B0qZHy5icbSYhedFeJ9dxjtYytILCSOcXzmFlNv2IAINiI2HCLWVw7UWjECrU/sbEJtvMLfGOfhVz5/VNg7lFrJKKxmllf3VFg7W2thfrsdITzkTGnvfsMJdiGg/ItoHej+W1ufU+Xx7ArEzBZEuiA1ArA+0PkdtBuxvMPc+owajSCfRIUx3IYb3BobnGquvyshMX0XMVWHk8/V7GIEmjOlCcp4q+FJpX3p5rMz2+cxwX7KvHMhf2dqZBKUafHXgqyXz8xaWUgv+OpCrITUGW68dn3/jryW7VMPxSo3t7Uy+CdvvUENxpEQigZ5MousOm5vJC7Wu66ecZamUw/ksoesoisJfubHLzOpXKQYAAAAASUVORK5CYII=');background-size:cover;display:block"></span> <img src="https://wesbos.com/static/0df6d3765de1c7655990bfa9878a06a5/5a190/1252.png" title="select a currency and on hovering over the form, currency is switched out to usd" alt="select a currency and on hovering over the form, currency is switched out to usd" class="gatsby-resp-image-image" /> </span>

Now our entry point has almost nothing in it because it is in a separate file.

Is that okay?

Yes, some people like their entry point to have a little code but you could have also left all the code in `money.js` as well and it still would have worked!

Find an issue with this post? Think you could clarify, update or add something?

All my posts are available to edit on Github. Any fix, little or small, is appreciated!

[Edit on Github](https://github.com/wesbos/wesbos/tree/master/src/javascript/14-es-modules-and-structuring-larger-apps/79-currency-module-refactor/79-currency-module-refactor.mdx)

[**← Prev**](https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/78-modules/)

Modules

[**Next →**](https://wesbos.com/javascript/14-es-modules-and-structuring-larger-apps/80-dad-jokes-modules-refactor/)

Dad Jokes Modules Refactor

### <span class="highlight">Syntax Podcast</span>

Hold on — I'm grabbin' the last one.
